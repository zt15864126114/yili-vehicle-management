import{d as re,r as c,c as K,h as H,e as t,w as a,b as i,o as x,f as M,j as u,t as v,F as E,i as $,E as pe,B as R,a as L,_ as me}from"./index-xhAZHyxu.js";const ce={class:"inspection-list"},ve={class:"card-header"},fe={class:"table-container"},ge={class:"pagination-container"},be={class:"dialog-footer"},he="calc(100vh - 330px)",_e=re({__name:"InspectionList",setup(De){const r=c({vehicleNumber:"",status:"",dateRange:[]}),U={pending:"待年检",completed:"已年检",failed:"未通过"},Y=n=>({pending:"warning",completed:"success",failed:"danger"})[n]||"info",O=()=>{const n=["鲁H85697","鲁H67M89","鲁H2N680","鲁H1U579","鲁HK7K11","鲁H9M229","鲁H3S338","鲁H4K472"],e=["济宁市机动车检测中心","兖州区机动车检测站","济宁高新区机动车检测中心","济宁市交通局检测中心"],s=["张志强","李建国","王大明","刘海洋","赵国强"];return Array.from({length:30},(m,d)=>{const p=j(12),w=new Date(new Date(p).setFullYear(new Date(p).getFullYear()+1)).toISOString().split("T")[0];return{id:String(d+1),vehicleId:String(Math.floor(Math.random()*8)+1),vehicleNumber:n[Math.floor(Math.random()*n.length)],inspectionDate:p,nextInspectionDate:w,location:e[Math.floor(Math.random()*e.length)],cost:Math.floor(Math.random()*500)+500,status:["pending","completed","completed","completed","failed"][Math.floor(Math.random()*5)],handler:s[Math.floor(Math.random()*s.length)],remarks:"",inspectionItems:[{name:"外观检查",passed:Math.random()>.1},{name:"底盘检查",passed:Math.random()>.1},{name:"尾气检测",passed:Math.random()>.1},{name:"制动性能",passed:Math.random()>.1},{name:"灯光检测",passed:Math.random()>.1},{name:"安全装置",passed:Math.random()>.1}]}})},j=(n=12)=>{const e=new Date,s=new Date(e.getTime()-n*30*24*60*60*1e3),m=s.getTime()+Math.random()*(e.getTime()-s.getTime());return new Date(m).toISOString().split("T")[0]},h=c(O()),_=c(1),y=c(10),T=K(()=>h.value.filter(n=>{var d;const e=!r.value.vehicleNumber||n.vehicleNumber.includes(r.value.vehicleNumber),s=!r.value.status||n.status===r.value.status;let m=!0;if(((d=r.value.dateRange)==null?void 0:d.length)===2){const p=n.inspectionDate;m=p>=r.value.dateRange[0]&&p<=r.value.dateRange[1]}return e&&s&&m}).sort((n,e)=>new Date(e.inspectionDate).getTime()-new Date(n.inspectionDate).getTime())),A=K(()=>{const n=(_.value-1)*y.value,e=n+y.value;return T.value.slice(n,e)}),V=c(!1),N=c(!1),I=c("add"),D=c(),f=c({id:"",vehicleNumber:"",inspectionDate:"",nextInspectionDate:"",location:"",cost:0,status:"",handler:"",remarks:"",inspectionItems:[]}),F=c([{id:"1",plateNumber:"鲁H85697"},{id:"2",plateNumber:"鲁H67M89"},{id:"3",plateNumber:"鲁H2N680"},{id:"4",plateNumber:"鲁H1U579"},{id:"5",plateNumber:"鲁HK7K11"},{id:"6",plateNumber:"鲁H9M229"},{id:"7",plateNumber:"鲁H3S338"},{id:"8",plateNumber:"鲁H4K472"}]),o=c({vehicleId:"",vehicleNumber:"",inspectionDate:"",nextInspectionDate:"",location:"",cost:0,status:"",handler:"",remarks:"",inspectionItems:[]}),P={vehicleId:[{required:!0,message:"请选择车辆",trigger:["blur","change"]}],inspectionDate:[{required:!0,message:"请选择年检日期",trigger:["blur","change"]}],location:[{required:!0,message:"请输入年检地点",trigger:"blur"}],cost:[{required:!0,message:"请输入年检费用",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:["blur","change"]}],handler:[{required:!0,message:"请输入经办人",trigger:"blur"}]},G=n=>{const e=F.value.find(s=>s.id===n);e&&(o.value.vehicleNumber=e.plateNumber)},J=()=>{if(o.value.inspectionDate){const n=new Date(o.value.inspectionDate);n.setFullYear(n.getFullYear()+1),o.value.nextInspectionDate=n.toISOString().split("T")[0]}},Q=n=>{y.value=n,_.value=1},W=n=>{_.value=n},X=()=>{_.value=1},Z=()=>{r.value={vehicleNumber:"",status:"",dateRange:[]},_.value=1},ee=n=>{f.value=n,N.value=!0},te=()=>{I.value="add",o.value={vehicleId:"",vehicleNumber:"",inspectionDate:"",nextInspectionDate:"",location:"",cost:0,status:"pending",handler:"",remarks:"",inspectionItems:[]},V.value=!0,D.value&&D.value.clearValidate()},z=c(""),le=n=>{z.value=n.id,I.value="edit",o.value={...n},V.value=!0,D.value&&D.value.clearValidate()},ae=n=>{pe.confirm("确定要删除该年检记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.value=h.value.filter(e=>e.id!==n.id),R.success("删除成功")})},ne=async()=>{D.value&&await D.value.validate((n,e)=>{if(n){if(I.value==="add"){const s={id:String(Date.now()),...o.value,inspectionItems:[{name:"外观检查",passed:!0},{name:"底盘检查",passed:!0},{name:"尾气检测",passed:!0},{name:"制动性能",passed:!0},{name:"灯光检测",passed:!0},{name:"安全装置",passed:!0}]};h.value.unshift(s),R.success("新增成功")}else{const s=h.value.findIndex(m=>m.id===z.value);s!==-1&&(h.value[s]={...h.value[s],...o.value},R.success("更新成功"))}V.value=!1}else console.log("验证失败",e)})};return(n,e)=>{const s=i("el-button"),m=i("el-input"),d=i("el-form-item"),p=i("el-option"),w=i("el-select"),C=i("el-date-picker"),B=i("el-form"),g=i("el-table-column"),S=i("el-tag"),oe=i("el-table"),se=i("el-pagination"),ue=i("el-card"),de=i("el-input-number"),q=i("el-dialog"),b=i("el-descriptions-item"),ie=i("el-descriptions");return x(),H("div",ce,[t(ue,{class:"inspection-card"},{header:a(()=>[M("div",ve,[e[17]||(e[17]=M("span",null,"年检记录",-1)),t(s,{type:"primary",onClick:te},{default:a(()=>e[16]||(e[16]=[u("新增记录")])),_:1})])]),default:a(()=>[t(B,{inline:!0,model:r.value,class:"search-form"},{default:a(()=>[t(d,{label:"车牌号"},{default:a(()=>[t(m,{modelValue:r.value.vehicleNumber,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.vehicleNumber=l),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),t(d,{label:"状态"},{default:a(()=>[t(w,{modelValue:r.value.status,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.status=l),placeholder:"请选择状态",clearable:""},{default:a(()=>[t(p,{label:"待年检",value:"pending"}),t(p,{label:"已年检",value:"completed"}),t(p,{label:"未通过",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"年检日期"},{default:a(()=>[t(C,{modelValue:r.value.dateRange,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(s,{type:"primary",onClick:X},{default:a(()=>e[18]||(e[18]=[u("搜索")])),_:1}),t(s,{onClick:Z},{default:a(()=>e[19]||(e[19]=[u("重置")])),_:1})]),_:1})]),_:1},8,["model"]),M("div",fe,[t(oe,{data:A.value,style:{width:"100%"},height:he},{default:a(()=>[t(g,{prop:"vehicleNumber",label:"车牌号",width:"120"}),t(g,{prop:"inspectionDate",label:"年检日期",width:"120"}),t(g,{prop:"nextInspectionDate",label:"下次年检日期",width:"120"}),t(g,{prop:"location",label:"年检地点","min-width":"180"}),t(g,{prop:"cost",label:"年检费用",width:"120"},{default:a(({row:l})=>[u(" ¥"+v(l.cost.toFixed(2)),1)]),_:1}),t(g,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(S,{type:Y(l.status)},{default:a(()=>[u(v(U[l.status]),1)]),_:2},1032,["type"])]),_:1}),t(g,{prop:"handler",label:"经办人",width:"100"}),t(g,{prop:"remarks",label:"备注","min-width":"150","show-overflow-tooltip":""}),t(g,{label:"操作",width:"180",fixed:"right"},{default:a(({row:l})=>[t(s,{type:"primary",link:"",onClick:k=>ee(l)},{default:a(()=>e[20]||(e[20]=[u("查看")])),_:2},1032,["onClick"]),t(s,{type:"primary",link:"",onClick:k=>le(l)},{default:a(()=>e[21]||(e[21]=[u("编辑")])),_:2},1032,["onClick"]),t(s,{type:"danger",link:"",onClick:k=>ae(l)},{default:a(()=>e[22]||(e[22]=[u("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),M("div",ge,[t(se,{"current-page":_.value,"onUpdate:currentPage":e[3]||(e[3]=l=>_.value=l),"page-size":y.value,"onUpdate:pageSize":e[4]||(e[4]=l=>y.value=l),"page-sizes":[10,15,20,30],total:T.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:W,background:""},null,8,["current-page","page-size","total"])])]),_:1}),t(q,{title:I.value==="add"?"新增年检记录":"编辑年检记录",modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=l=>V.value=l),width:"500px"},{footer:a(()=>[M("span",be,[t(s,{onClick:e[13]||(e[13]=l=>V.value=!1)},{default:a(()=>e[23]||(e[23]=[u("取消")])),_:1}),t(s,{type:"primary",onClick:ne},{default:a(()=>e[24]||(e[24]=[u("确定")])),_:1})])]),default:a(()=>[t(B,{ref_key:"formRef",ref:D,model:o.value,rules:P,"label-width":"100px",style:{"max-height":"60vh","overflow-y":"auto"}},{default:a(()=>[t(d,{label:"车辆",prop:"vehicleId"},{default:a(()=>[t(w,{modelValue:o.value.vehicleId,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.vehicleId=l),placeholder:"请选择车辆",style:{width:"100%"},onChange:G},{default:a(()=>[(x(!0),H(E,null,$(F.value,l=>(x(),L(p,{key:l.id,label:l.plateNumber,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"年检日期",prop:"inspectionDate"},{default:a(()=>[t(C,{modelValue:o.value.inspectionDate,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.inspectionDate=l),type:"date",placeholder:"选择年检日期",style:{width:"100%"},"value-format":"YYYY-MM-DD",onChange:J},null,8,["modelValue"])]),_:1}),t(d,{label:"下次年检",prop:"nextInspectionDate"},{default:a(()=>[t(C,{modelValue:o.value.nextInspectionDate,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.nextInspectionDate=l),type:"date",placeholder:"选择下次年检日期",style:{width:"100%"},"value-format":"YYYY-MM-DD",disabled:!0},null,8,["modelValue"])]),_:1}),t(d,{label:"年检地点",prop:"location"},{default:a(()=>[t(m,{modelValue:o.value.location,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.location=l),placeholder:"请输入年检地点"},null,8,["modelValue"])]),_:1}),t(d,{label:"年检费用",prop:"cost"},{default:a(()=>[t(de,{modelValue:o.value.cost,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.cost=l),min:0,precision:2,step:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(d,{label:"状态",prop:"status"},{default:a(()=>[t(w,{modelValue:o.value.status,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.status=l),placeholder:"请选择状态",style:{width:"100%"}},{default:a(()=>[t(p,{label:"待年检",value:"pending"}),t(p,{label:"已年检",value:"completed"}),t(p,{label:"未通过",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"经办人",prop:"handler"},{default:a(()=>[t(m,{modelValue:o.value.handler,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.handler=l),placeholder:"请输入经办人"},null,8,["modelValue"])]),_:1}),t(d,{label:"备注",prop:"remarks"},{default:a(()=>[t(m,{modelValue:o.value.remarks,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.remarks=l),type:"textarea",rows:"3",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(q,{title:"年检详情",modelValue:N.value,"onUpdate:modelValue":e[15]||(e[15]=l=>N.value=l),width:"600px"},{default:a(()=>[t(ie,{column:2,border:""},{default:a(()=>[t(b,{label:"车牌号"},{default:a(()=>[u(v(f.value.vehicleNumber),1)]),_:1}),t(b,{label:"年检日期"},{default:a(()=>[u(v(f.value.inspectionDate),1)]),_:1}),t(b,{label:"下次年检日期"},{default:a(()=>[u(v(f.value.nextInspectionDate),1)]),_:1}),t(b,{label:"年检费用"},{default:a(()=>{var l;return[u("¥"+v((l=f.value.cost)==null?void 0:l.toFixed(2)),1)]}),_:1}),t(b,{label:"年检地点",span:2},{default:a(()=>[u(v(f.value.location),1)]),_:1}),t(b,{label:"状态"},{default:a(()=>[t(S,{type:Y(f.value.status)},{default:a(()=>[u(v(U[f.value.status]),1)]),_:1},8,["type"])]),_:1}),t(b,{label:"经办人"},{default:a(()=>[u(v(f.value.handler),1)]),_:1}),t(b,{label:"备注",span:2},{default:a(()=>[u(v(f.value.remarks||"无"),1)]),_:1}),t(b,{label:"检测项目",span:2},{default:a(()=>[(x(!0),H(E,null,$(f.value.inspectionItems,(l,k)=>(x(),L(S,{key:k,type:l.passed?"success":"danger",style:{"margin-right":"5px","margin-bottom":"5px"}},{default:a(()=>[u(v(l.name)+": "+v(l.passed?"通过":"未通过"),1)]),_:2},1032,["type"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),ye=me(_e,[["__scopeId","data-v-3bea80d6"]]);export{ye as default};
