import{i as k}from"./index-CFFsEcQF.js";import{d as ge,r as u,c as T,z as be,D as $,G as ye,h as Ce,e as t,w as l,b as s,o as M,f as o,j as c,t as r,H as Q,a as L,_ as we}from"./index-xhAZHyxu.js";const xe={class:"cost-analysis"},Ne={class:"control-panel"},ke={class:"controls"},Me={class:"stat-cards"},De={class:"card-header"},Ve={class:"card-value"},Re={class:"card-trend"},Fe={class:"card-value"},ze={class:"card-percent"},Le={class:"card-value"},Se={class:"card-percent"},Oe={class:"card-value"},Ae={class:"card-percent"},Ee={class:"chart-section"},He={class:"chart-header"},Be={class:"chart-header"},Te={class:"ranking-header"},Ue={class:"cost-cell"},Pe={class:"cost-cell"},Ye={class:"cost-cell"},qe={class:"progress-cell"},Ie={class:"detail-content"},Ke=ge({__name:"CostAnalysis",setup(je){const U=u([new Date,new Date]),S=u("month"),D=u("total"),V=u("total"),g=u(null),O=u();let y=null,_=null;const C=u(!1),P=u(null),A=u(null);let w=[];const Z=u([{id:"1",plateNumber:"鲁H1234J",type:"大型货车"},{id:"2",plateNumber:"鲁H5678K",type:"中型货车"},{id:"3",plateNumber:"鲁H9012L",type:"小型货车"},{id:"4",plateNumber:"鲁H3456M",type:"重型货车"},{id:"5",plateNumber:"鲁H7890N",type:"轻型货车"},{id:"6",plateNumber:"鲁HK888A",type:"中型货车"},{id:"7",plateNumber:"鲁HB666B",type:"小型货车"},{id:"8",plateNumber:"鲁HM999C",type:"重型货车"},{id:"9",plateNumber:"鲁HD235D",type:"轻型货车"},{id:"10",plateNumber:"鲁HF567E",type:"大型货车"}]),ee=()=>{const a={fuel:Math.floor(Math.random()*5e3)+3e3,maintenance:Math.floor(Math.random()*1e4)+2e3,other:Math.floor(Math.random()*1e3)};return{total:a.fuel+a.maintenance+a.other,...a}},m=T(()=>{const a=ee(),e=a.total;return{total:h(e),fuel:{amount:h(a.fuel),percentage:Number((a.fuel/e*100).toFixed(1))},maintenance:{amount:h(a.maintenance),percentage:Number((a.maintenance/e*100).toFixed(1))},other:{amount:h(a.other),percentage:Number((a.other/e*100).toFixed(1))}}}),h=a=>new Intl.NumberFormat("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a),x=u(Y());function Y(){return Z.value.map(a=>({id:a.id,plateNumber:a.plateNumber,totalCost:Math.floor(Math.random()*5e4)+1e4,fuelCost:Math.floor(Math.random()*2e4)+5e3,maintenanceCost:Math.floor(Math.random()*3e4)+5e3,yearOverYear:(Math.random()*20-10).toFixed(1)}))}const q=()=>{if(!g.value)return;y=k(g.value);const a={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{type:"pie",radius:"70%",data:[{value:Number(m.value.fuel.amount.replace(/,/g,"")),name:"燃油费用"},{value:Number(m.value.maintenance.amount.replace(/,/g,"")),name:"维修保养费用"},{value:Number(m.value.other.amount.replace(/,/g,"")),name:"其他费用"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};y.setOption(a)},I=()=>{if(!O.value)return;_=k(O.value);const a=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],e={tooltip:{trigger:"axis"},xAxis:{type:"category",data:a},yAxis:{type:"value"},series:[{data:a.map(()=>Math.floor(Math.random()*5e4)+1e4),type:"line",smooth:!0}]};_.setOption(e)},R=()=>{y==null||y.resize(),_==null||_.resize()};be(()=>{q(),I(),window.addEventListener("resize",R),F()});const K=()=>{q(),I()},te=()=>{K()},ae=()=>{K()},le=T(()=>{switch(S.value){case"month":return"本月";case"quarter":return"本季度";case"year":return"本年";default:return""}}),E=u(5.8),oe=[{text:"最近一周",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,a]}},{text:"最近一月",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}}],ne=()=>{C.value=!0},se=()=>{if(!_)return;const a=de();_.setOption({series:[{data:a[D.value==="total"?"totalData":D.value==="fuel"?"fuelData":"maintenanceData"]}]})},F=()=>{const a=Y();x.value=a.sort((e,d)=>{switch(V.value){case"total":return d.totalCost-e.totalCost;case"fuel":return d.fuelCost-e.fuelCost;case"maintenance":return d.maintenanceCost-e.maintenanceCost;default:return d.totalCost-e.totalCost}})};$(V,()=>{F()});const j=T(()=>x.value.reduce((a,e)=>a+e.totalCost,0)),re=a=>a>=50?"#F56C6C":a>=30?"#E6A23C":"#67C23A",ue=a=>{C.value=!0,console.log("显示车辆详情:",a.plateNumber)},de=()=>{const a=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],e=a.map(()=>Math.floor(Math.random()*3e3)+4e3),d=a.map(()=>Math.floor(Math.random()*2e3)+1500),p=a.map((N,b)=>e[b]+d[b]);return{months:a,fuelData:e,maintenanceData:d,totalData:p}},ie=({prop:a,order:e})=>{if(!a||!e){F();return}const d=[...x.value];x.value=d.sort((p,N)=>{const b=e==="ascending"?1:-1;return(p[a]-N[a])*b})},ce=()=>{if(k(P.value).setOption({grid:{top:40,right:20,bottom:40,left:50},tooltip:{trigger:"axis",formatter:"{b}<br/>总费用: ¥{c}"},xAxis:{type:"category",data:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],axisLine:{lineStyle:{color:"#909399"}}},yAxis:{type:"value",axisLabel:{formatter:"¥{value}"}},series:[{data:[null,null,null,null,null,null,null,null,15800,16200,16500,17100],type:"line",smooth:!0,symbol:"circle",symbolSize:8,lineStyle:{width:3,color:"#409EFF"},itemStyle:{color:"#409EFF"}}]}),g.value){const e=k(g.value);e.setOption({tooltip:{trigger:"item",formatter:"{b}: ¥{c} ({d}%)"},legend:{orient:"horizontal",top:0},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {d}%"},data:[{value:28500,name:"燃油费用"},{value:18600,name:"维修费用"},{value:12e3,name:"保养费用"},{value:6500,name:"停车费用"},{value:4800,name:"保险费用"},{value:3200,name:"其他费用"}]}]}),w.push(e)}if(A.value){const e=k(A.value);e.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["燃油费用","维修保养费用","停车费用","其他费用"],top:0},grid:{top:40,right:20,bottom:40,left:50},xAxis:{type:"category",data:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},yAxis:{type:"value",axisLabel:{formatter:"¥{value}"}},series:[{name:"燃油费用",type:"bar",stack:"total",data:[null,null,null,null,null,null,null,null,7e3,7200,7100,7200],itemStyle:{color:"#409EFF"}},{name:"维修保养费用",type:"bar",stack:"total",data:[null,null,null,null,null,null,null,null,5800,5900,6200,6300],itemStyle:{color:"#95d475"}},{name:"停车费用",type:"bar",stack:"total",data:[null,null,null,null,null,null,null,null,1600,1700,1800,1900],itemStyle:{color:"#ffd666"}},{name:"其他费用",type:"bar",stack:"total",data:[null,null,null,null,null,null,null,null,1400,1400,1400,1700],itemStyle:{color:"#909399"}}]}),w.push(e)}};return $(C,a=>{a?window.addEventListener("resize",R):(w.forEach(e=>e==null?void 0:e.dispose()),w=[],window.removeEventListener("resize",R))}),ye(()=>{w.forEach(a=>a==null?void 0:a.dispose()),window.removeEventListener("resize",R)}),(a,e)=>{const d=s("el-date-picker"),p=s("el-radio-button"),N=s("el-radio-group"),b=s("el-tag"),G=s("CaretTop"),J=s("CaretBottom"),H=s("el-icon"),i=s("el-card"),f=s("el-col"),B=s("el-row"),me=s("DataLine"),W=s("el-button"),pe=s("el-tooltip"),z=s("el-option"),fe=s("el-select"),v=s("el-table-column"),ve=s("el-progress"),_e=s("el-table"),he=s("el-dialog");return M(),Ce("div",xe,[t(i,{class:"main-card"},{default:l(()=>[o("div",Ne,[e[8]||(e[8]=o("div",{class:"title"},"费用统计分析",-1)),o("div",ke,[t(d,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=n=>U.value=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:oe,onChange:te},null,8,["modelValue"]),t(N,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=n=>S.value=n),onChange:ae},{default:l(()=>[t(p,{label:"month"},{default:l(()=>e[5]||(e[5]=[c("月度")])),_:1}),t(p,{label:"quarter"},{default:l(()=>e[6]||(e[6]=[c("季度")])),_:1}),t(p,{label:"year"},{default:l(()=>e[7]||(e[7]=[c("年度")])),_:1})]),_:1},8,["modelValue"])])]),o("div",Me,[t(B,{gutter:20},{default:l(()=>[t(f,{span:6},{default:l(()=>[t(i,{class:"stat-card total-cost",shadow:"hover"},{default:l(()=>[o("div",De,[e[9]||(e[9]=o("span",null,"总费用支出",-1)),t(b,{size:"small"},{default:l(()=>[c(r(le.value),1)]),_:1})]),o("div",Ve,"¥"+r(m.value.total),1),o("div",Re,[e[10]||(e[10]=c(" 较上期 ")),o("span",{class:Q(E.value>=0?"up":"down")},[c(r(Math.abs(E.value))+"% ",1),t(H,null,{default:l(()=>[E.value>=0?(M(),L(G,{key:0})):(M(),L(J,{key:1}))]),_:1})],2)])]),_:1})]),_:1}),t(f,{span:6},{default:l(()=>[t(i,{class:"stat-card fuel-cost",shadow:"hover"},{default:l(()=>[e[11]||(e[11]=o("div",{class:"card-header"},"燃油费用",-1)),o("div",Fe,"¥"+r(m.value.fuel.amount),1),o("div",ze,"占比 "+r(m.value.fuel.percentage)+"%",1)]),_:1})]),_:1}),t(f,{span:6},{default:l(()=>[t(i,{class:"stat-card maintenance-cost",shadow:"hover"},{default:l(()=>[e[12]||(e[12]=o("div",{class:"card-header"},"维修保养费用",-1)),o("div",Le,"¥"+r(m.value.maintenance.amount),1),o("div",Se,"占比 "+r(m.value.maintenance.percentage)+"%",1)]),_:1})]),_:1}),t(f,{span:6},{default:l(()=>[t(i,{class:"stat-card other-cost",shadow:"hover"},{default:l(()=>[e[13]||(e[13]=o("div",{class:"card-header"},"其他费用",-1)),o("div",Oe,"¥"+r(m.value.other.amount),1),o("div",Ae,"占比 "+r(m.value.other.percentage)+"%",1)]),_:1})]),_:1})]),_:1})]),o("div",Ee,[t(B,{gutter:20},{default:l(()=>[t(f,{span:12},{default:l(()=>[t(i,{class:"chart-card",shadow:"hover"},{header:l(()=>[o("div",He,[e[14]||(e[14]=o("span",null,"费用构成分析",-1)),t(pe,{content:"查看详细数据"},{default:l(()=>[t(W,{link:"",onClick:ne},{default:l(()=>[t(H,null,{default:l(()=>[t(me)]),_:1})]),_:1})]),_:1})])]),default:l(()=>[o("div",{ref_key:"pieChartRef",ref:g,class:"chart"},null,512)]),_:1})]),_:1}),t(f,{span:12},{default:l(()=>[t(i,{class:"chart-card",shadow:"hover"},{header:l(()=>[o("div",Be,[e[15]||(e[15]=o("span",null,"费用趋势分析",-1)),t(fe,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=n=>D.value=n),style:{width:"120px"},onChange:se},{default:l(()=>[t(z,{label:"总费用",value:"total"}),t(z,{label:"燃油费用",value:"fuel"}),t(z,{label:"维修费用",value:"maintenance"}),t(z,{label:"其他费用",value:"other"})]),_:1},8,["modelValue"])])]),default:l(()=>[o("div",{ref_key:"lineChartRef",ref:O,class:"chart"},null,512)]),_:1})]),_:1})]),_:1})]),t(i,{class:"ranking-card",shadow:"hover"},{header:l(()=>[o("div",Te,[e[19]||(e[19]=o("span",null,"车辆费用排名",-1)),t(N,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=n=>V.value=n),size:"small",onChange:F},{default:l(()=>[t(p,{label:"total"},{default:l(()=>e[16]||(e[16]=[c("总费用")])),_:1}),t(p,{label:"fuel"},{default:l(()=>e[17]||(e[17]=[c("燃油费")])),_:1}),t(p,{label:"maintenance"},{default:l(()=>e[18]||(e[18]=[c("维修费")])),_:1})]),_:1},8,["modelValue"])])]),default:l(()=>[t(_e,{data:x.value,border:"",stripe:"",onSortChange:ie},{default:l(()=>[t(v,{label:"排名",type:"index",width:"80"}),t(v,{label:"车牌号",prop:"plateNumber"}),t(v,{label:"总费用",prop:"totalCost",sortable:"custom","sort-orders":["descending","ascending"]},{default:l(({row:n})=>[o("span",Ue,"¥"+r(h(n.totalCost)),1)]),_:1}),t(v,{label:"燃油费用",prop:"fuelCost",sortable:"custom","sort-orders":["descending","ascending"]},{default:l(({row:n})=>[o("span",Pe,"¥"+r(h(n.fuelCost)),1)]),_:1}),t(v,{label:"维修费用",prop:"maintenanceCost",sortable:"custom","sort-orders":["descending","ascending"]},{default:l(({row:n})=>[o("span",Ye,"¥"+r(h(n.maintenanceCost)),1)]),_:1}),t(v,{label:"费用占比",width:"200"},{default:l(({row:n})=>[o("div",qe,[t(ve,{percentage:Number(Number(n.totalCost)/Number(j.value)*100).toFixed(1),format:X=>X+"%",color:re(Number(Number(n.totalCost)/Number(j.value)*100))},null,8,["percentage","format","color"])])]),_:1}),t(v,{label:"同比",width:"120"},{default:l(({row:n})=>[o("span",{class:Q(n.yearOverYear>=0?"up":"down")},[c(r(Math.abs(n.yearOverYear))+"% ",1),t(H,null,{default:l(()=>[n.yearOverYear>=0?(M(),L(G,{key:0})):(M(),L(J,{key:1}))]),_:2},1024)],2)]),_:1}),t(v,{label:"操作",width:"120"},{default:l(({row:n})=>[t(W,{type:"primary",link:"",onClick:X=>ue(n)},{default:l(()=>e[20]||(e[20]=[c(" 详情分析 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),t(he,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=n=>C.value=n),title:"费用详情分析",width:"90%","destroy-on-close":!0,onOpened:ce},{default:l(()=>[o("div",Ie,[t(B,{gutter:20},{default:l(()=>[t(f,{span:8},{default:l(()=>[t(i,null,{header:l(()=>e[21]||(e[21]=[o("div",{class:"card-header"},"月度费用趋势",-1)])),default:l(()=>[o("div",{ref_key:"trendChartRef",ref:P,style:{width:"100%",height:"300px",border:"1px solid #eee"}},null,512)]),_:1})]),_:1}),t(f,{span:8},{default:l(()=>[t(i,null,{header:l(()=>e[22]||(e[22]=[o("div",{class:"card-header"},"费用构成分析",-1)])),default:l(()=>[o("div",{ref_key:"pieChartRef",ref:g,style:{width:"100%",height:"300px"}},null,512)]),_:1})]),_:1}),t(f,{span:8},{default:l(()=>[t(i,null,{header:l(()=>e[23]||(e[23]=[o("div",{class:"card-header"},"同比环比分析",-1)])),default:l(()=>[o("div",{ref_key:"compareChartRef",ref:A,style:{width:"100%",height:"300px"}},null,512)]),_:1})]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}}}),We=we(Ke,[["__scopeId","data-v-768fb801"]]);export{We as default};
