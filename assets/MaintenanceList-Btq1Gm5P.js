import{d as de,r as g,c as q,h as k,e as l,w as t,b as s,o as _,f as M,j as c,t as N,F as H,i as x,E as ie,B as C,a as B,_ as se}from"./index-xhAZHyxu.js";const me={class:"maintenance-list"},pe={class:"card-header"},ce={class:"table-container"},ve={class:"pagination-container"},ge={class:"dialog-footer"},fe="calc(100vh - 330px)",be=de({__name:"MaintenanceList",setup(he){const i=g({vehicleNumber:"",maintenanceType:"",status:"",dateRange:[]}),K={ongoing:"进行中",completed:"已完成",pending:"待处理"},E={regular:"定期保养",repair:"故障维修",emergency:"紧急维修"},F=n=>({ongoing:"primary",completed:"success",pending:"warning"})[n]||"info",L=n=>({regular:"info",repair:"warning",emergency:"danger"})[n]||"info",U=["机油更换","机油滤清器更换","空气滤清器更换","刹车片更换","轮胎更换","电瓶维护","变速箱油更换","冷却液更换","发动机维修","底盘维护","车灯维修","空调维修"],$=()=>{const n=["鲁H85697","鲁H67M89","鲁H2N680","鲁H1U579","鲁HK7K11","鲁H9M229","鲁H3S338","鲁H4K472"],e=["公司维修车间","济宁市汽车维修中心","解放4S店济宁店","东风4S店济宁店","重汽4S店济宁店"],u=["张师傅","李师傅","王师傅","刘师傅","赵师傅"];return Array.from({length:50},(m,r)=>{const d=j(6),p=new Date(new Date(d).getTime()+Math.random()*72*60*60*1e3).toISOString().slice(0,16).replace("T"," "),V=U.sort(()=>Math.random()-.5).slice(0,Math.floor(Math.random()*3)+1);return{id:String(r+1),vehicleId:String(Math.floor(Math.random()*8)+1),vehicleNumber:n[Math.floor(Math.random()*n.length)],maintenanceType:["regular","repair","emergency"][Math.floor(Math.random()*3)],startTime:d.replace("T"," "),endTime:p,location:e[Math.floor(Math.random()*e.length)],cost:Math.floor(Math.random()*5e3)+500,items:V,status:["ongoing","completed","completed","completed","pending"][Math.floor(Math.random()*5)],handler:u[Math.floor(Math.random()*u.length)],remarks:""}})},j=(n=6)=>{const e=new Date,u=new Date(e.getTime()-n*30*24*60*60*1e3),m=u.getTime()+Math.random()*(e.getTime()-u.getTime());return new Date(m).toISOString().slice(0,16)},f=g($()),b=g(1),T=g(10),R=q(()=>f.value.filter(n=>{var d;const e=!i.value.vehicleNumber||n.vehicleNumber.includes(i.value.vehicleNumber),u=!i.value.maintenanceType||n.maintenanceType===i.value.maintenanceType,m=!i.value.status||n.status===i.value.status;let r=!0;if(((d=i.value.dateRange)==null?void 0:d.length)===2){const p=n.startTime.split(" ")[0];r=p>=i.value.dateRange[0]&&p<=i.value.dateRange[1]}return e&&u&&m&&r}).sort((n,e)=>new Date(e.startTime).getTime()-new Date(n.startTime).getTime())),A=q(()=>{const n=(b.value-1)*T.value,e=n+T.value;return R.value.slice(n,e)}),y=g(!1),w=g("add"),h=g(),I=g([{id:"1",plateNumber:"鲁H85697"},{id:"2",plateNumber:"鲁H67M89"},{id:"3",plateNumber:"鲁H2N680"},{id:"4",plateNumber:"鲁H1U579"},{id:"5",plateNumber:"鲁HK7K11"},{id:"6",plateNumber:"鲁H9M229"},{id:"7",plateNumber:"鲁H3S338"},{id:"8",plateNumber:"鲁H4K472"}]),o=g({vehicleId:"",vehicleNumber:"",maintenanceType:"",startTime:"",endTime:"",location:"",cost:0,items:[],status:"",handler:"",remarks:""}),O={vehicleId:[{required:!0,message:"请选择车辆",trigger:["blur","change"]}],maintenanceType:[{required:!0,message:"请选择维修类型",trigger:["blur","change"]}],startTime:[{required:!0,message:"请选择开始时间",trigger:["blur","change"]}],location:[{required:!0,message:"请输入维修地点",trigger:"blur"}],cost:[{required:!0,message:"请输入维修费用",trigger:"blur"}],items:[{required:!0,message:"请选择维修项目",trigger:["blur","change"]}],status:[{required:!0,message:"请选择状态",trigger:["blur","change"]}],handler:[{required:!0,message:"请输入经办人",trigger:"blur"}]},P=n=>{const e=I.value.find(u=>u.id===n);e&&(o.value.vehicleNumber=e.plateNumber)},G=n=>{T.value=n,b.value=1},J=n=>{b.value=n},Q=()=>{b.value=1},W=()=>{i.value={vehicleNumber:"",maintenanceType:"",status:"",dateRange:[]},b.value=1},X=()=>{w.value="add",o.value={vehicleId:"",vehicleNumber:"",maintenanceType:"",startTime:"",endTime:"",location:"",cost:0,items:[],status:"pending",handler:"",remarks:""},y.value=!0,h.value&&h.value.clearValidate()},Y=g(""),Z=n=>{Y.value=n.id,w.value="edit",o.value={...n},y.value=!0,h.value&&h.value.clearValidate()},ee=n=>{ie.confirm("确定要删除该维修记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{f.value=f.value.filter(e=>e.id!==n.id),C.success("删除成功")})},le=async()=>{h.value&&await h.value.validate((n,e)=>{if(n){if(w.value==="add"){const u={id:String(Date.now()),...o.value,status:"pending"};f.value.unshift(u),C.success("新增成功")}else{const u=f.value.findIndex(m=>m.id===Y.value);u!==-1&&(f.value[u]={...f.value[u],...o.value},C.success("更新成功"))}y.value=!1}else console.log("验证失败",e)})};return(n,e)=>{const u=s("el-button"),m=s("el-input"),r=s("el-form-item"),d=s("el-option"),p=s("el-select"),V=s("el-date-picker"),z=s("el-form"),v=s("el-table-column"),S=s("el-tag"),ae=s("el-table"),te=s("el-pagination"),ne=s("el-card"),oe=s("el-input-number"),ue=s("el-dialog");return _(),k("div",me,[l(ne,{class:"maintenance-card"},{header:t(()=>[M("div",pe,[e[19]||(e[19]=M("span",null,"维修记录",-1)),l(u,{type:"primary",onClick:X},{default:t(()=>e[18]||(e[18]=[c("新增记录")])),_:1})])]),default:t(()=>[l(z,{inline:!0,model:i.value,class:"search-form"},{default:t(()=>[l(r,{label:"车牌号"},{default:t(()=>[l(m,{modelValue:i.value.vehicleNumber,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value.vehicleNumber=a),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),l(r,{label:"维修类型"},{default:t(()=>[l(p,{modelValue:i.value.maintenanceType,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value.maintenanceType=a),placeholder:"请选择类型",clearable:""},{default:t(()=>[l(d,{label:"定期保养",value:"regular"}),l(d,{label:"故障维修",value:"repair"}),l(d,{label:"紧急维修",value:"emergency"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"状态"},{default:t(()=>[l(p,{modelValue:i.value.status,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.status=a),placeholder:"请选择状态",clearable:""},{default:t(()=>[l(d,{label:"进行中",value:"ongoing"}),l(d,{label:"已完成",value:"completed"}),l(d,{label:"待处理",value:"pending"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"维修日期"},{default:t(()=>[l(V,{modelValue:i.value.dateRange,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(u,{type:"primary",onClick:Q},{default:t(()=>e[20]||(e[20]=[c("搜索")])),_:1}),l(u,{onClick:W},{default:t(()=>e[21]||(e[21]=[c("重置")])),_:1})]),_:1})]),_:1},8,["model"]),M("div",ce,[l(ae,{data:A.value,style:{width:"100%"},height:fe},{default:t(()=>[l(v,{prop:"vehicleNumber",label:"车牌号",width:"120"}),l(v,{prop:"maintenanceType",label:"维修类型",width:"100"},{default:t(({row:a})=>[l(S,{type:L(a.maintenanceType)},{default:t(()=>[c(N(E[a.maintenanceType]),1)]),_:2},1032,["type"])]),_:1}),l(v,{prop:"startTime",label:"开始时间",width:"160"}),l(v,{prop:"endTime",label:"结束时间",width:"160"}),l(v,{prop:"location",label:"维修地点",width:"150"}),l(v,{prop:"cost",label:"维修费用",width:"120"},{default:t(({row:a})=>[c(" ¥"+N(a.cost.toFixed(2)),1)]),_:1}),l(v,{prop:"items",label:"维修项目","min-width":"200"},{default:t(({row:a})=>[(_(!0),k(H,null,x(a.items,(D,re)=>(_(),B(S,{key:re,size:"small",style:{"margin-right":"5px","margin-bottom":"5px"}},{default:t(()=>[c(N(D),1)]),_:2},1024))),128))]),_:1}),l(v,{prop:"status",label:"状态",width:"100"},{default:t(({row:a})=>[l(S,{type:F(a.status)},{default:t(()=>[c(N(K[a.status]),1)]),_:2},1032,["type"])]),_:1}),l(v,{prop:"handler",label:"经办人",width:"100"}),l(v,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[l(u,{type:"primary",link:"",onClick:D=>Z(a)},{default:t(()=>e[22]||(e[22]=[c("编辑")])),_:2},1032,["onClick"]),l(u,{type:"danger",link:"",onClick:D=>ee(a)},{default:t(()=>e[23]||(e[23]=[c("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),M("div",ve,[l(te,{"current-page":b.value,"onUpdate:currentPage":e[4]||(e[4]=a=>b.value=a),"page-size":T.value,"onUpdate:pageSize":e[5]||(e[5]=a=>T.value=a),"page-sizes":[10,15,20,30],total:R.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:J,background:""},null,8,["current-page","page-size","total"])])]),_:1}),l(ue,{title:w.value==="add"?"新增维修记录":"编辑维修记录",modelValue:y.value,"onUpdate:modelValue":e[17]||(e[17]=a=>y.value=a),width:"600px"},{footer:t(()=>[M("span",ge,[l(u,{onClick:e[16]||(e[16]=a=>y.value=!1)},{default:t(()=>e[24]||(e[24]=[c("取消")])),_:1}),l(u,{type:"primary",onClick:le},{default:t(()=>e[25]||(e[25]=[c("确定")])),_:1})])]),default:t(()=>[l(z,{ref_key:"formRef",ref:h,model:o.value,rules:O,"label-width":"100px",style:{"max-height":"60vh","overflow-y":"auto"}},{default:t(()=>[l(r,{label:"车辆",prop:"vehicleId"},{default:t(()=>[l(p,{modelValue:o.value.vehicleId,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.vehicleId=a),placeholder:"请选择车辆",style:{width:"100%"},onChange:P},{default:t(()=>[(_(!0),k(H,null,x(I.value,a=>(_(),B(d,{key:a.id,label:a.plateNumber,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"维修类型",prop:"maintenanceType"},{default:t(()=>[l(p,{modelValue:o.value.maintenanceType,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.maintenanceType=a),placeholder:"请选择维修类型",style:{width:"100%"}},{default:t(()=>[l(d,{label:"定期保养",value:"regular"}),l(d,{label:"故障维修",value:"repair"}),l(d,{label:"紧急维修",value:"emergency"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"开始时间",prop:"startTime"},{default:t(()=>[l(V,{modelValue:o.value.startTime,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.startTime=a),type:"datetime",placeholder:"选择开始时间",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm"},null,8,["modelValue"])]),_:1}),l(r,{label:"结束时间",prop:"endTime"},{default:t(()=>[l(V,{modelValue:o.value.endTime,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.endTime=a),type:"datetime",placeholder:"选择结束时间",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm"},null,8,["modelValue"])]),_:1}),l(r,{label:"维修地点",prop:"location"},{default:t(()=>[l(m,{modelValue:o.value.location,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.location=a),placeholder:"请输入维修地点"},null,8,["modelValue"])]),_:1}),l(r,{label:"维修费用",prop:"cost"},{default:t(()=>[l(oe,{modelValue:o.value.cost,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.cost=a),min:0,precision:2,step:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(r,{label:"维修项目",prop:"items"},{default:t(()=>[l(p,{modelValue:o.value.items,"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.items=a),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入维修项目",style:{width:"100%"}},{default:t(()=>[(_(),k(H,null,x(U,a=>l(d,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"状态",prop:"status"},{default:t(()=>[l(p,{modelValue:o.value.status,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.status=a),placeholder:"请选择状态",style:{width:"100%"}},{default:t(()=>[l(d,{label:"进行中",value:"ongoing"}),l(d,{label:"已完成",value:"completed"}),l(d,{label:"待处理",value:"pending"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"经办人",prop:"handler"},{default:t(()=>[l(m,{modelValue:o.value.handler,"onUpdate:modelValue":e[14]||(e[14]=a=>o.value.handler=a),placeholder:"请输入经办人"},null,8,["modelValue"])]),_:1}),l(r,{label:"备注",prop:"remarks"},{default:t(()=>[l(m,{modelValue:o.value.remarks,"onUpdate:modelValue":e[15]||(e[15]=a=>o.value.remarks=a),type:"textarea",rows:"3",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),_e=se(be,[["__scopeId","data-v-4443d6ba"]]);export{_e as default};
