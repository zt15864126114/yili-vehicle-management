import{d as ne,r as p,c as U,h as k,e as l,w as r,b as s,o as V,f as N,j as g,t as Y,F as R,i as z,B as D,E as de,a as B,_ as ie}from"./index-xhAZHyxu.js";const se={class:"trip-list"},me={class:"card-header"},pe={class:"table-container"},ve={class:"pagination-container"},ce={class:"dialog-footer"},ge="calc(100vh - 330px)",fe=ne({__name:"TripList",setup(be){const n=p({vehicleNumber:"",driverName:"",status:"",dateRange:[]}),q={ongoing:"进行中",completed:"已完成",cancelled:"已取消"},K=t=>({ongoing:"primary",completed:"success",cancelled:"info"})[t]||"info",E=()=>{const t=["鲁H85697","鲁H67M89","鲁H2N680","鲁H1U579","鲁HK7K11","鲁H9M229","鲁H3S338","鲁H4K472"],e=["张志强","李建国","王大明","刘海洋","赵国强","孙志远","周建军","吴海波","郑光明","马建设"],u=["兖州-济南-兖州","兖州-泰安-兖州","兖州-枣庄-兖州","兖州-临沂-兖州","兖州-青岛-兖州","兖州-潍坊-兖州"],m=["原料运输","成品配送","设备维修","客户接待","商务出差","货物配送"];return Array.from({length:50},(d,i)=>{const v=F(1),T=new Date(new Date(v).getTime()+Math.random()*24*60*60*1e3).toISOString().slice(0,16).replace("T"," ");return{id:String(i+1),vehicleId:String(Math.floor(Math.random()*8)+1),vehicleNumber:t[Math.floor(Math.random()*t.length)],driverId:String(Math.floor(Math.random()*10)+1),driverName:e[Math.floor(Math.random()*e.length)],departureTime:v.replace("T"," "),returnTime:T,mileage:Math.floor(Math.random()*300)+100,route:u[Math.floor(Math.random()*u.length)],purpose:m[Math.floor(Math.random()*m.length)],status:["ongoing","completed","completed","completed","cancelled"][Math.floor(Math.random()*5)],remarks:""}})},F=(t=1)=>{const e=new Date,u=new Date(e.getTime()-t*30*24*60*60*1e3),m=u.getTime()+Math.random()*(e.getTime()-u.getTime());return new Date(m).toISOString().slice(0,16)},f=p(E()),b=p(1),_=p(10),I=U(()=>f.value.filter(t=>{var i;const e=!n.value.vehicleNumber||t.vehicleNumber.includes(n.value.vehicleNumber),u=!n.value.driverName||t.driverName.includes(n.value.driverName),m=!n.value.status||t.status===n.value.status;let d=!0;if(((i=n.value.dateRange)==null?void 0:i.length)===2){const v=t.departureTime.split(" ")[0];d=v>=n.value.dateRange[0]&&v<=n.value.dateRange[1]}return e&&u&&m&&d}).sort((t,e)=>new Date(e.departureTime).getTime()-new Date(t.departureTime).getTime())),L=U(()=>{const t=(b.value-1)*_.value,e=t+_.value;return I.value.slice(t,e)}),$=t=>{_.value=t,b.value=1},j=t=>{b.value=t},A=()=>{b.value=1},O=()=>{n.value={vehicleNumber:"",driverName:"",status:"",dateRange:[]},b.value=1},h=p(!1),y=p("add"),M=p(),o=p({vehicleId:"",vehicleNumber:"",driverId:"",driverName:"",departureTime:"",returnTime:"",mileage:0,route:"",purpose:"",status:"ongoing",remarks:""}),P={vehicleId:[{required:!0,message:"请选择车辆",trigger:"change"}],driverId:[{required:!0,message:"请选择驾驶员",trigger:"change"}],departureTime:[{required:!0,message:"请选择出发时间",trigger:"change"}],returnTime:[{required:!0,message:"请选择返回时间",trigger:"change"}],mileage:[{required:!0,message:"请输入预计里程",trigger:"blur"}],route:[{required:!0,message:"请输入行驶路线",trigger:"blur"}],purpose:[{required:!0,message:"请选择用途",trigger:"change"}]},C=p([{id:"1",plateNumber:"鲁H85697"},{id:"2",plateNumber:"鲁H67M89"},{id:"3",plateNumber:"鲁H2N680"},{id:"4",plateNumber:"鲁H1U579"},{id:"5",plateNumber:"鲁HK7K11"},{id:"6",plateNumber:"鲁H9M229"},{id:"7",plateNumber:"鲁H3S338"},{id:"8",plateNumber:"鲁H4K472"}]),w=p([{id:"1",name:"张志强"},{id:"2",name:"李建国"},{id:"3",name:"王大明"},{id:"4",name:"刘海洋"},{id:"5",name:"赵国强"},{id:"6",name:"孙志远"},{id:"7",name:"周建军"},{id:"8",name:"吴海波"},{id:"9",name:"郑光明"},{id:"10",name:"马建设"}]),G=t=>{const e=C.value.find(u=>u.id===t);e&&(o.value.vehicleNumber=e.plateNumber)},J=t=>{const e=w.value.find(u=>u.id===t);e&&(o.value.driverName=e.name)},H=t=>t.getTime()<Date.now()-24*60*60*1e3,Q=()=>{y.value="add",o.value={vehicleId:"",vehicleNumber:"",driverId:"",driverName:"",departureTime:"",returnTime:"",mileage:0,route:"",purpose:"",status:"ongoing",remarks:""},h.value=!0},S=p(""),W=t=>{S.value=t.id,y.value="edit",o.value={vehicleId:t.vehicleId,vehicleNumber:t.vehicleNumber,driverId:t.driverId,driverName:t.driverName,departureTime:t.departureTime,returnTime:t.returnTime,mileage:t.mileage,route:t.route,purpose:t.purpose,status:t.status,remarks:t.remarks},h.value=!0},X=async()=>{M.value&&await M.value.validate((t,e)=>{if(t){if(y.value==="add"){const u={id:String(Date.now()),...o.value,status:"ongoing"};f.value.unshift(u),D.success("新增成功")}else{const u=f.value.findIndex(m=>m.id===S.value);u!==-1&&(f.value[u]={...f.value[u],...o.value},D.success("更新成功"))}h.value=!1}else console.log("验证失败",e)})},Z=t=>{de.confirm("确定要删除该出车记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{f.value=f.value.filter(e=>e.id!==t.id),D.success("删除成功")})};return(t,e)=>{const u=s("el-button"),m=s("el-input"),d=s("el-form-item"),i=s("el-option"),v=s("el-select"),T=s("el-date-picker"),x=s("el-form"),c=s("el-table-column"),ee=s("el-tag"),le=s("el-table"),ae=s("el-pagination"),te=s("el-card"),re=s("el-input-number"),ue=s("el-dialog");return V(),k("div",se,[l(te,{class:"trip-card"},{header:r(()=>[N("div",me,[e[17]||(e[17]=N("span",null,"出车记录",-1)),l(u,{type:"primary",onClick:Q},{default:r(()=>e[16]||(e[16]=[g("新增记录")])),_:1})])]),default:r(()=>[l(x,{inline:!0,model:n.value,class:"search-form"},{default:r(()=>[l(d,{label:"车牌号"},{default:r(()=>[l(m,{modelValue:n.value.vehicleNumber,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.vehicleNumber=a),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),l(d,{label:"驾驶员"},{default:r(()=>[l(m,{modelValue:n.value.driverName,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.driverName=a),placeholder:"请输入驾驶员姓名"},null,8,["modelValue"])]),_:1}),l(d,{label:"状态"},{default:r(()=>[l(v,{modelValue:n.value.status,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.status=a),placeholder:"请选择状态",clearable:""},{default:r(()=>[l(i,{label:"进行中",value:"ongoing"}),l(i,{label:"已完成",value:"completed"}),l(i,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"出车日期"},{default:r(()=>[l(T,{modelValue:n.value.dateRange,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(d,null,{default:r(()=>[l(u,{type:"primary",onClick:A},{default:r(()=>e[18]||(e[18]=[g("搜索")])),_:1}),l(u,{onClick:O},{default:r(()=>e[19]||(e[19]=[g("重置")])),_:1})]),_:1})]),_:1},8,["model"]),N("div",pe,[l(le,{data:L.value,style:{width:"100%"},height:ge},{default:r(()=>[l(c,{prop:"vehicleNumber",label:"车牌号",width:"120"}),l(c,{prop:"driverName",label:"驾驶员",width:"100"}),l(c,{prop:"departureTime",label:"出车时间",width:"160"}),l(c,{prop:"returnTime",label:"返回时间",width:"160"}),l(c,{prop:"mileage",label:"行驶里程",width:"100"},{default:r(({row:a})=>[g(Y(a.mileage)+" km ",1)]),_:1}),l(c,{prop:"route",label:"行驶路线","min-width":"200"}),l(c,{prop:"purpose",label:"用途",width:"150"}),l(c,{prop:"status",label:"状态",width:"100"},{default:r(({row:a})=>[l(ee,{type:K(a.status)},{default:r(()=>[g(Y(q[a.status]),1)]),_:2},1032,["type"])]),_:1}),l(c,{label:"操作",width:"150",fixed:"right"},{default:r(({row:a})=>[l(u,{type:"primary",link:"",onClick:oe=>W(a)},{default:r(()=>e[20]||(e[20]=[g("编辑")])),_:2},1032,["onClick"]),l(u,{type:"danger",link:"",onClick:oe=>Z(a)},{default:r(()=>e[21]||(e[21]=[g("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),N("div",ve,[l(ae,{"current-page":b.value,"onUpdate:currentPage":e[4]||(e[4]=a=>b.value=a),"page-size":_.value,"onUpdate:pageSize":e[5]||(e[5]=a=>_.value=a),"page-sizes":[10,15,20,30],total:I.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:j,background:""},null,8,["current-page","page-size","total"])])]),_:1}),l(ue,{title:y.value==="add"?"新增出车记录":"编辑出车记录",modelValue:h.value,"onUpdate:modelValue":e[15]||(e[15]=a=>h.value=a),width:"600px"},{footer:r(()=>[N("span",ce,[l(u,{onClick:e[14]||(e[14]=a=>h.value=!1)},{default:r(()=>e[22]||(e[22]=[g("取消")])),_:1}),l(u,{type:"primary",onClick:X},{default:r(()=>e[23]||(e[23]=[g("确定")])),_:1})])]),default:r(()=>[l(x,{ref_key:"formRef",ref:M,model:o.value,rules:P,"label-width":"100px",style:{"max-height":"60vh","overflow-y":"auto"}},{default:r(()=>[l(d,{label:"车辆",prop:"vehicleId"},{default:r(()=>[l(v,{modelValue:o.value.vehicleId,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.vehicleId=a),placeholder:"请选择车辆",style:{width:"100%"},onChange:G},{default:r(()=>[(V(!0),k(R,null,z(C.value,a=>(V(),B(i,{key:a.id,label:a.plateNumber,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"驾驶员",prop:"driverId"},{default:r(()=>[l(v,{modelValue:o.value.driverId,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.driverId=a),placeholder:"请选择驾驶员",style:{width:"100%"},onChange:J},{default:r(()=>[(V(!0),k(R,null,z(w.value,a=>(V(),B(i,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"出发时间",prop:"departureTime"},{default:r(()=>[l(T,{modelValue:o.value.departureTime,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.departureTime=a),type:"datetime",placeholder:"选择出发时间",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm","disabled-date":H},null,8,["modelValue"])]),_:1}),l(d,{label:"预计返回",prop:"returnTime"},{default:r(()=>[l(T,{modelValue:o.value.returnTime,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.returnTime=a),type:"datetime",placeholder:"选择预计返回时间",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm","disabled-date":H},null,8,["modelValue"])]),_:1}),l(d,{label:"预计里程",prop:"mileage"},{default:r(()=>[l(re,{modelValue:o.value.mileage,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.mileage=a),min:1,max:9999,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"行驶路线",prop:"route"},{default:r(()=>[l(m,{modelValue:o.value.route,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.route=a),placeholder:"请输入行驶路线"},null,8,["modelValue"])]),_:1}),l(d,{label:"用途",prop:"purpose"},{default:r(()=>[l(v,{modelValue:o.value.purpose,"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.purpose=a),placeholder:"请选择用途",style:{width:"100%"}},{default:r(()=>[l(i,{label:"原料运输",value:"原料运输"}),l(i,{label:"成品配送",value:"成品配送"}),l(i,{label:"设备维修",value:"设备维修"}),l(i,{label:"客户接待",value:"客户接待"}),l(i,{label:"商务出差",value:"商务出差"}),l(i,{label:"货物配送",value:"货物配送"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"备注",prop:"remarks"},{default:r(()=>[l(m,{modelValue:o.value.remarks,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.remarks=a),type:"textarea",rows:"3",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),_e=ie(fe,[["__scopeId","data-v-7bd9b036"]]);export{_e as default};
